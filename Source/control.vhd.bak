library ieee;
use ieee.std_logic_1164.all;

entity control is
  generic(
	 TAM_IMG    : integer := 102; -- Tamanho da imagem
	 TAM_KERNEL : integer := 3    -- Tamanho do kernel (3 => 3x3; 5 => 5x5; 7 => 7x7)
  );
	port(
	 i_CLOCK         : in  std_logic;
	 i_RESET         : in  std_logic;
	 o_FlagProcess   : out std_logic
	);
end entity control;

architecture arch1 of control is

  type STATE is (Reset, PreencheRB, Processa);
  signal Atual    : STATE;
  signal Proximo  : STATE;
  
begin

	p_ATUAL : process (i_RESET, i_CLOCK)
	
		-- Contador para preencher os row buffers e +1 linha do kernel	
		variable v_DELAY_PROCESS : integer range 0 to ((TAM_KERNEL - 1)*TAM_IMG + (TAM_KERNEL + 1)) := 0;
	
	begin
		if (i_RESET = '1') then
			Atual <= Reset;
		elsif (rising_edge(i_CLOCK)) then
		
			case Atual is	
			
				when Reset =>
					Atual <= PreencheRB;
					
				when PreencheRB =>
				  
				  if(v_DELAY_PROCESS < ((TAM_KERNEL - 1)*TAM_IMG + (TAM_KERNEL + 1))) then
					   v_DELAY_PROCESS := v_DELAY_PROCESS + 1;
					   Atual <= PreencheRB;
				  else
					   Atual <= Processa;
				  end if;
					
				when Processa =>
				  Atual <= Processa;
				  
			end case;
		
		end if;
	end process p_ATUAL;
		
	o_FlagProcess <= '1' when Atual = Processa else '0';
	
end arch1;
